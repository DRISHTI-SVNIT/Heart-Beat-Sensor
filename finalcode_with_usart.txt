/*go to the following sites for knowing more about interrupt
https://youtu.be/1OvTQIK16nc
http://youtube.com/watch?v=aT1tU0EnSHw
must watch the second video uploaded by human hard drive
the following code is written for atmega128
the result is displayed using usart
u should include necessary usart library
debug the code if it does't work..
make sure hardware is working perfectly
u can removing the comments after reading them
*/



#define F_CPU 8000000UL
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include "USART_128.h"


volatile int i = 0,j=0, k=0;


int heartbeat(int a)     //function for calculating heart beat per minute
{
			//formula is...frequency*60/TCNTn/prescaler..in my case prescaler is 1
k=(8000000*60)/a;
return k;
}



ISR(INT1_vect){			//interrupt service routine for calculating TCNT1 value between 2 pulse
	
	
	j=heartbeat(TCNT1);	//calling heartbeat function with arguement TCNT1
	i=1;			//for jumping to if statement inside while

	}

	
void interrupt_config()
{
	EIMSK |= (1<<INT1);			//enable interrupt 1
	EICRB |= (1<<ISC10)|(1<<ISC11);		//configure interrupt for rising edge
	TCCR1B|=(1<<CS10);			//no prescaler, this also start TCNT1
}	



int main(void)
{
	USART_Init(51,0);			//initialize interrupt with baud rate 9600
	interrupt_config();			//call function for initializing registers for interrupt
	
		while(1)
	{
		if(i==1)			//if loop for jumping the code here after ISR
		{
		USART_TransmitNumber(j,0);	//transmit value of heart beat
		USART_Transmitchar(0x0d,0);	//for new line
		TCNT1=0;			//reset timer counter 2 (TCNT1)..so it may not add next time
		}
		
    	}
}




